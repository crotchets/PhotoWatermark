# 照片水印添加程序 PRD（产品需求文档）

## 1. 产品概述

### 1.1 产品名称
PhotoWatermark - 照片水印添加工具

### 1.2 产品描述
一个基于Python的命令行工具，能够自动为照片添加基于EXIF拍摄时间的文本水印。程序将读取指定目录下所有图片的EXIF信息，提取拍摄日期，并将其作为水印添加到图片上。

### 1.3 目标用户
- 摄影师和摄影爱好者
- 需要为照片批量添加时间戳的用户
- 图片整理和归档需求的用户

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 图片路径输入
- **功能描述**：用户可以输入一个包含图片的文件夹路径
- **输入方式**：命令行参数或交互式输入
- **支持格式**：绝对路径和相对路径
- **验证要求**：
  - 路径存在性验证
  - 目录访问权限验证
  - 包含有效图片文件验证

#### 2.1.2 EXIF信息读取
- **功能描述**：读取指定目录下所有图片文件的EXIF信息
- **支持的图片格式**：
  - JPEG (.jpg, .jpeg)
  - TIFF (.tiff, .tif)
  - RAW格式（基础支持）
- **提取信息**：
  - 拍摄时间（DateTimeOriginal）
  - 备选：DateTimeDigitized, DateTime
- **数据格式**：提取年-月-日信息（YYYY-MM-DD格式）
- **异常处理**：
  - 无EXIF信息的图片处理
  - 损坏或无效的EXIF数据处理

#### 2.1.3 水印配置
- **字体大小设置**：
  - 支持像素单位（默认：36px）
  - 范围：12px - 200px
  - 自动缩放选项（基于图片尺寸）
- **颜色设置**：
  - RGB颜色值支持
  - 预设颜色选项（白色、黑色、红色等）
  - 透明度设置（0-100%）
- **位置设置**：
  - 九宫格位置选择：
    - 左上角（top-left）
    - 上中（top-center）
    - 右上角（top-right）
    - 左中（middle-left）
    - 居中（center）
    - 右中（middle-right）
    - 左下角（bottom-left）
    - 下中（bottom-center）
    - 右下角（bottom-right）
  - 自定义像素偏移量设置

#### 2.1.4 水印绘制和保存
- **水印绘制**：
  - 文本渲染引擎
  - 字体选择（系统字体/自定义字体）
  - 背景透明度处理
  - 文字描边/阴影效果（可选）
- **文件保存**：
  - 创建"原目录名_watermark"子目录
  - 保持原始文件名
  - 保持原始图片质量
  - 支持批量处理

### 2.2 辅助功能

#### 2.2.1 进度显示
- 批量处理进度条
- 当前处理文件名显示
- 处理速度统计

#### 2.2.2 日志记录
- 处理成功/失败日志
- 错误信息详细记录
- 处理统计信息

#### 2.2.3 预览功能
- 单张图片水印效果预览
- 水印位置和样式调整

## 3. 技术需求

### 3.1 开发语言和框架
- **主要语言**：Python 3.8+
- **图像处理库**：Pillow (PIL)
- **EXIF处理库**：exifread 或 Pillow.ExifTags
- **命令行界面**：argparse 或 click
- **进度显示**：tqdm

### 3.2 系统要求
- **操作系统**：Windows 10+, macOS 10.14+, Linux
- **Python版本**：3.8或更高版本
- **内存要求**：至少512MB可用内存
- **磁盘空间**：处理图片所需的双倍存储空间

### 3.3 性能要求
- 单张图片处理时间：< 3秒（一般尺寸）
- 支持批量处理：100+张图片
- 内存使用：< 500MB（批量处理）

## 4. 用户界面设计

### 4.1 命令行界面
```bash
# 基础用法
python photowatermark.py --input /path/to/photos

# 完整参数
python photowatermark.py \
  --input /path/to/photos \
  --font-size 48 \
  --color "255,255,255" \
  --position bottom-right \
  --opacity 80 \
  --preview
```

### 4.2 交互式配置
- 如果用户未提供参数，程序进入交互模式
- 逐步引导用户设置各项参数
- 提供默认值和建议

### 4.3 输出信息格式
```
PhotoWatermark v1.0
==================
输入目录: /path/to/photos
找到图片: 25张
配置信息:
  - 字体大小: 36px
  - 颜色: 白色 (255,255,255)
  - 位置: 右下角
  - 透明度: 80%

处理进度:
[████████████████████████████████] 100% (25/25) 完成

结果:
  - 成功处理: 23张
  - 跳过 (无EXIF): 2张
  - 失败: 0张
  - 输出目录: /path/to/photos/photos_watermark
```

## 5. 错误处理

### 5.1 输入验证错误
- 无效路径
- 权限不足
- 目录为空或无有效图片

### 5.2 图片处理错误
- 文件损坏或无法读取
- EXIF信息缺失或损坏
- 图片格式不支持

### 5.3 输出错误
- 磁盘空间不足
- 输出目录创建失败
- 文件保存权限问题

## 6. 测试需求

### 6.1 单元测试
- EXIF信息读取功能
- 水印位置计算算法
- 图片处理和保存功能

### 6.2 集成测试
- 完整的批量处理流程
- 不同图片格式的兼容性
- 各种参数组合的测试

### 6.3 用户验收测试
- 真实场景的批量处理
- 不同操作系统的兼容性
- 性能和稳定性测试

## 7. 部署和发布

### 7.1 打包方式
- pip安装包
- 独立可执行文件（PyInstaller）
- Docker镜像（可选）

### 7.2 文档要求
- 安装说明
- 使用教程
- API文档
- 故障排除指南

## 8. 版本规划

### 8.1 v1.0（MVP）
- 基础的EXIF读取和水印添加
- 命令行界面
- 基础的位置和样式设置

### 8.2 v1.1（功能增强）
- GUI界面支持
- 更多字体和样式选项
- 批处理优化

### 8.3 v2.0（高级功能）
- 多种水印模板
- 图片元数据保护
- 云存储集成

## 9. 风险和限制

### 9.1 技术风险
- EXIF标准的多样性
- 不同图片格式的兼容性问题
- 大文件处理的内存限制

### 9.2 使用限制
- 依赖EXIF信息的完整性
- 处理速度受图片大小和数量影响
- 字体在不同系统上的可用性差异

## 10. 成功标准

### 10.1 功能完整性
- 支持主流图片格式的EXIF读取
- 水印添加准确率 > 95%
- 批处理稳定性

### 10.2 用户体验
- 操作简单直观
- 错误信息清晰易懂
- 处理速度满足用户期望

### 10.3 代码质量
- 代码覆盖率 > 80%
- 文档完整性
- 可维护性和可扩展性

---

**创建日期**: 2025年9月22日  
**版本**: v1.0  
**状态**: 草案
